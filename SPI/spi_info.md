# SPI (Serial Peripheral Interface) Communication Protocol

## üß† What is SPI?

**SPI (Serial Peripheral Interface)** is a **synchronous, full-duplex** serial communication protocol used for short-distance communication, primarily in **embedded systems**. It's commonly used to communicate between a **microcontroller (master)** and **peripheral devices (slaves)** like sensors, memory chips, ADCs/DACs, displays, etc.

---

## ‚öôÔ∏è SPI Basics

- **Synchronous**: Uses a **clock line (SCLK)** to synchronize data.
- **Full-duplex**: Can send and receive data **simultaneously**.
- **Master-slave architecture**: One master controls one or more slaves.

---

## üîå SPI Pin Configuration

| Pin Name | Direction (Master POV) | Function |
|----------|------------------------|----------|
| **MOSI** (Master Out Slave In) | Output | Data from master to slave |
| **MISO** (Master In Slave Out) | Input  | Data from slave to master |
| **SCLK** (Serial Clock)        | Output | Clock signal from master |
| **SS/CS** (Slave Select / Chip Select) | Output | Selects a slave (active LOW) |

> For multiple slaves, each needs a separate **SS** line.

---

## üß± SPI Data Frame Format

SPI transmits data in **8-bit**, **16-bit**, or **32-bit** frames depending on configuration.

Each transmission includes:

- Clock pulses (**SCLK**) generated by the master
- Bits transmitted on **MOSI** and **MISO**
- **No start or stop bits** (unlike UART)

### üìã Example: 8-bit Frame

| Clock Pulse | Bit 7 | Bit 6 | Bit 5 | Bit 4 | Bit 3 | Bit 2 | Bit 1 | Bit 0 |
|-------------|-------|-------|-------|-------|-------|-------|-------|-------|
| MOSI        |  1    |  0    |  1    |  0    |  1    |  1    |  0    |  0    |
| MISO        |  0    |  1    |  0    |  1    |  0    |  0    |  1    |  1    |

> Both lines are active during transfer. One byte goes in, one comes out at the same time.

---

## ‚öôÔ∏è Clock Polarity and Phase (CPOL, CPHA)

These settings control when data is sampled and shifted. There are 4 SPI modes:

| Mode | CPOL | CPHA | Clock Idle | Data Capture |
|------|------|------|------------|---------------|
| 0    | 0    | 0    | Low        | Rising Edge   |
| 1    | 0    | 1    | Low        | Falling Edge  |
| 2    | 1    | 0    | High       | Falling Edge  |
| 3    | 1    | 1    | High       | Rising Edge   |

> Both master and slave must use the same mode.

---

## üîÑ How SPI Works (Step-by-step)

1. **Master sets the clock frequency**.
2. **Master pulls SS/CS of desired slave LOW**.
3. **Master sends data on MOSI** and generates clock on SCLK.
4. **Slave reads data on MOSI, responds on MISO**.
5. **SS is pulled HIGH**, ending communication.

---

## üì¶ Use Cases (Where/When is SPI Used?)

- **Sensors** (e.g., gyroscope, accelerometer)
- **Flash memory chips** (EEPROM, NOR/NAND flash)
- **SD cards**
- **LCDs and OLEDs**
- **DACs/ADCs**
- **RTC (Real-Time Clock) modules**

> Used when **high-speed**, **short-range** communication is needed.

---

## ‚úÖ Advantages of SPI

| Advantage          | Description                               |
|-------------------|-------------------------------------------|
| **Fast**           | Speeds in MHz range                       |
| **Full-Duplex**    | Simultaneous send/receive                 |
| **Simple Protocol**| No addressing, start/stop bits           |
| **Flexible Frame** | 8/16/32-bit support                       |
| **Low Power**      | Efficient with minimal overhead           |

---

## ‚ùå Disadvantages of SPI

| Disadvantage         | Description                                      |
|----------------------|--------------------------------------------------|
| **No Standard Protocol** | Protocol logic must be implemented manually |
| **No Error Checking**    | No ACK/NACK or built-in CRC                  |
| **Requires More Pins**   | 4 wires + extra SS for each slave            |
| **Short Distance Only**  | <1 meter for reliability                     |
| **Single Master (usually)** | Multi-master is rare and complex         |

---

## üß† SPI vs I¬≤C vs UART

| Feature         | SPI          | I¬≤C           | UART          |
|----------------|--------------|---------------|---------------|
| Wires needed    | 4+           | 2             | 2             |
| Speed           | High (MHz)   | Moderate      | Moderate      |
| Full-duplex     | ‚úÖ           | ‚ùå             | ‚úÖ            |
| Addressing      | ‚ùå           | ‚úÖ             | ‚ùå            |
| Multi-master    | ‚ùå (complex) | ‚úÖ             | ‚ùå            |
| Error Checking  | ‚ùå (manual)  | ‚úÖ (ACK/NACK)  | ‚úÖ (parity)   |
| Simplicity      | Simple       | More complex  | Simple        |

---

## üì∑ SPI Connection Diagram

```
         Master
        +--------+
MOSI --->|        |
MISO <---|        |
SCLK --->|        |
SS1  --->|        |
SS2  --->|        |
        +--------+
           |  |_____
           |       |
       +--------+ +--------+
       | Slave1 | | Slave2 |
       +--------+ +--------+
```

---

## üß™ Real-World Example

### Connecting an SPI Temperature Sensor

1. Connect sensor‚Äôs MOSI/MISO/SCLK/CS to microcontroller.
2. Set SPI mode and speed (e.g., mode 0, 1 MHz).
3. Pull CS LOW.
4. Send command to read temperature.
5. Read response.
6. Pull CS HIGH.

---

## üîå 1. Normal (Parallel) SPI Connection

Also known as **independent** or **multi-slave SPI**.

### üß© How It Works
- All slaves share **MOSI**, **MISO**, and **SCLK** lines.
- Each slave has its own **dedicated CS (Chip Select)** line.
- The **master controls the CS lines** to select which slave to communicate with.
- Only one slave is active at a time, responding to the master.

### üì∑ Diagram

```
          Master
        +--------+
MOSI --->|        |
MISO <---|        |
SCLK --->|        |
CS1  --->|        |
CS2  --->|        |
        +--------+
          |      |
        +-+-+  +-+-+
        |S1 |  |S2 |   <-- Independent Slaves
        +---+  +---+
```

### ‚úÖ Pros
- Simple to implement and manage.
- Independent communication with each slave.
- Each slave can have different roles and behaviors.

### ‚ùå Cons
- Requires **more GPIO pins** on the master (1 CS per slave).
- Less scalable with limited microcontroller I/O.

---

## üîÑ 2. Daisy-Chained SPI Connection

Used when the SPI devices **support daisy-chaining**, such as:
- **Shift registers (e.g., 74HC595)**
- **LED drivers (e.g., MAX7219)**
- **Motor drivers (e.g., TMC2130)**

### üß© How It Works
- **MOSI** goes into the first device, and its output is passed to the next device.
- All devices **share the same CS and SCLK lines**.
- Data is shifted from one device to the next.
- Devices latch their data **when CS goes HIGH**.

### üì∑ Diagram

```
       Master
     +--------+
MOSI --->     |
MISO <---     |
SCLK --->     |
CS    --->    |
     +--------+
          |
        +------+     +------+     +------+
        | S1   | --> | S2   | --> | S3   |
        | (IN) |     | (IN) |     | (IN) |
        | (OUT)|     | (OUT)|     | (OUT)|
        +------+     +------+     +------+

     (All share same CS, SCLK lines)
```

> Think of it as a **pipeline**: bits go in one end, travel through each device, and everyone picks their piece when the CS goes HIGH.

### ‚úÖ Pros
- Uses **fewer pins** (only one CS line for all).
- Clean and compact wiring.
- Easily scalable with identical devices.

### ‚ùå Cons
- All devices must support daisy-chaining.
- More complex communication logic:
  - You may need to send **data for all devices** even if only one needs to be updated.
- Increased **latency** as data has to pass through each device.

---

## ‚öôÔ∏è Use Case Comparison

| Feature                | Normal SPI                  | Daisy-Chained SPI           |
|------------------------|-----------------------------|------------------------------|
| Chip Select Lines      | One per slave               | Single shared CS line        |
| Device Communication   | Direct (individual)         | Sequential (through chain)   |
| Device Compatibility   | Any SPI device              | Only daisy-chain-capable     |
| Scalability            | Limited by GPIO availability| Easily scalable              |
| Communication Speed    | Fast, individual            | Slower for large chains      |
| Simplicity             | Easier to program/manage    | More complex data handling   |

---

## üß™ Real-World Examples

### Normal SPI
- Sensors (e.g., MPU6050, ADXL345)
- EEPROMs
- Flash memory
- SD cards

### Daisy-Chained SPI
- MAX7219 LED matrices
- TMC2130 stepper motor drivers
- 74HC595 shift registers
- Cascaded digital potentiometers

---

## üß† Summary

- Use **normal SPI** when working with **different types of devices** or when precise individual control is needed.
- Use **daisy-chained SPI** when using **identical devices in a sequence**, and you want to **save GPIO pins**.

